<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <!-- My CSS -->
    <title>Food Menu</title>
    <!--Google Font-->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <!--Stylesheet-->

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/static/Student/style.css">


    <title>Mess Management</title>
</head>

<body>
    <!-- SIDEBAR -->
    <section id="sidebar">
        <a href="#" class="brand">
            <i class='bx bxs-smile'></i>
            <span class="text">Mess Student</span>
        </a>
        <ul class="side-menu top">
            <li>
                <a href="/">
                    <i class='bx bxs-dashboard'></i>
                    <span class="text">Home</span>
                </a>
            </li>
            <li>

                <a href="/menu">
                    <i class='bx bx-dish'></i>
                    <span class="text">Menu</span>
                </a>
            </li>
            <li class="active">
                <a href="/analytics">
                    <i class='bx bxs-doughnut-chart'></i>
                    <span class="text">Analytics</span>
                </a>
            </li>
            <li>
                <a href="/challan">
                    <i class='bx bxs-doughnut-chart'></i>
                    <span class="text">See challan</span>
                </a>
            </li>
            <!-- <li>
				<a href="#">
					<i class='bx bx-user-plus' ></i>
					<span class="text">Add Student</span>
				</a>
			</li> -->


        </ul>
        <ul class="side-menu">

            <li>
                <a href="/logout" class="logout">
                    <i class='bx bxs-log-out-circle'></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>
    <!-- SIDEBAR -->

    <section id="content">
        <!-- NAVBAR -->
        <nav>
            <i class='bx bx-menu'></i>
            <!-- <a href="#" class="nav-link">Categories</a> -->
            <form action="#">
                <div class="form-input">
                    <!-- <input type="search" placeholder="Search..."> -->
                    <!-- <button type="submit" class="search-btn"><i class='bx bx-search'></i></button> -->
                </div>
            </form>
            <input type="checkbox" id="switch-mode" hidden>
            <label for="switch-mode" class="switch-mode"></label>
            <!-- <a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a> -->
            <a href="/profile" class="profile">
                <img src="static/img/people.png">
            </a>
        </nav>
        <!-- NAVBAR -->
        <main>
            <ul class="box-info">
                <li>
                    <i class='bx bxs-dollar-circle'></i>
                    <span class="text">

                        <h3 id="billAmount">0/-</h3>
                        <p>Total Bill</p>
                    </span>
                </li>
                <li>
                    <i class='bx bxs-doughnut-chart'></i>
                    <span class="text">

                        <h3 id="numberOfAttendences">0</h3>
                        <p>Total attendances</p>
                    </span>
                </li>


                <li>
                    <i class='bx bxs-cloud-download'></i>
                    <a href="/challan"><span class="text">
                            <h3>Download Challan</h3>

                        </span></a>
                </li>


            </ul>
            <div class="page-wrapper">
                <div class="content">
                    <div class="row">
                        <div class="col-sm-12">
                            <h4 class="page-title">Attendance Sheet</h4>
                            <h3 id="email" style="display: none;">{{email}}</h3>
                        </div>
                    </div>
                    <div class="row filter-row">
                        <!-- <div class="col-sm-6 col-md-3">
                            <div class="form-group form-focus select-focus">
                                <label class="focus-label">Select meal</label>
                                <select class="select floating">
                                    <option>-</option>
                                    <option>BreakFast</option>
                                    <option>Dinner</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="form-group form-focus select-focus">
                                <label class="focus-label">Select Month</label>
                                <select class="select floating">
                                    <option>-</option>
                                    <option>Jan</option>
                                    <option>Feb</option>
                                    <option>Mar</option>
                                    <option>Apr</option>
                                    <option>May</option>
                                    <option>Jun</option>
                                    <option>Jul</option>
                                    <option>Aug</option>
                                    <option>Sep</option>
                                    <option>Oct</option>
                                    <option>Nov</option>
                                    <option>Dec</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-3">
                            <div class="form-group form-focus select-focus">
                                <label class="focus-label">Select Year</label>
                                <select class="select floating">
                                    <option>-</option>
                                    <option>2017</option>
                                    <option>2016</option>
                                    <option>2015</option>
                                    <option>2014</option>
                                    <option>2013</option>
                                </select>
                            </div>
                        </div> -->

                    </div>
                    <div class="table-data">
                        <div class="order">
                            <div class="head">
                                <h3>All Users</h3>

                                <!-- <i class='bx bx-search' ></i> -->
                                <i class='bx bx-filter'></i>
                            </div>
                            <div class="col-lg-6">
                                <table class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Day</th>
                                            <th>Lunch</th>
                                            <th>Lunch Price</th>
                                            <th>Attendanc status</th>
                                            <th>Dinner</th>
                                            <th>Dinner Price</th>
                                            <th>Attendanc status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="exampleid">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>


        </main>

    </section>
    <!-- CONTENT -->
    <script>
        function getDatefromResult(result, date) {
            for (let index = 0; index < result.length; index++) {

                //console.log(date);
                if (parseInt(result[index]['Date']) === date) {
                    return index;
                }
            }

            return -1;
        }
        let result;
        let email = document.getElementById('email').innerText
        const days = new Date().getDay().toString();

        $(document).ready(function () {
            // let menuTitle =new Array(7);

            // console.log(menuTitle);
            $.ajax({
                url: "/api/menu/", // url where to submit the request
                type: "GET", // type of action POST || GET
                dataType: 'json',
                contentType: "application/json; charset=utf-8",

                success: function (response) {
                    $.ajax({
                        url: "/api/attendenced", // url where to submit the request
                        type: "GET", // type of action POST || GET
                        dataType: 'json',
                        contentType: "application/json; charset=utf-8",

                        success: function (result) {
                            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

                            console.log(response);
                            let currentDate = new Date().getDate();

                            let temp = new Date();

                            for (let i = 0; i < 7; i++) {
                                let dinnerStatus = "absent";
                                let index = currentDate - i ;
                                //  console.log(index);
                                let lunchStatus = "absent";
                                let ind = getDatefromResult(result, index);
                                temp.setDate(index);
                                let newDay = temp.getDay();
                                // console.log(index);
                                // console.log(daysOfWeek[newDay]);
                                if (ind != -1) {
                                    if (result[ind]['DinnerList'].indexOf(email) != -1) {
                                        dinnerStatus = "present";
                                    }
                                    if (result[ind]['LunchList'].indexOf(email) != -1) {
                                        lunchStatus = "present";
                                    }

                                }
                                let din = "completed";
                                let lun = "completed";

                                //  console.log(response[]['day']);
                                // console.log(index);
                                let dayIndex = (newDay == 0 ? 6 : newDay - 1);
                                lun = lunchStatus == "absent" ? "pending" : "completed";
                                din = dinnerStatus == "absent" ? "pending" : "completed";
                                let rupee = "/-";
                                $('#exampleid').append(`<tr>\
                                    <td>`+ index + `</td>\
                                    <td>`+ response[dayIndex]['day'] + `</td>\
                                    <td>`+ response[dayIndex]['lunch'] + `</td>\
                                    <td>`+ `Rs.` + response[dayIndex]['lunchPrice'] + `/-` + `</td>\
                                    <td>\<span class='status ${lun}'>` + lunchStatus + `</span>\</td>\
								<td>`+ response[dayIndex]['dinner'] + `</td>\
								<td>`+ `Rs.` + response[dayIndex]['dinnerPrice'] + `/-` + `</td>\
								<td>\<span class='status ${din}'>` + dinnerStatus + `</span>\</td>\

								</tr>`);
                            }
                        }
                    })

                },
                error: function (xhr, resp, text) {
                    console.log(xhr, resp, text);
                    $('body').append('<h2>Error Occured</h2>')
                }
            })

        });
    </script>

    <script>
        $(document).ready(function () {
            var currentuser = document.getElementById("email").innerText
            $.ajax({
                url: `/api/updateBill/${currentuser}`, // url where to submit the request
                type: "GET",
                dataType: 'json',
                contentType: "application/json; charset=utf-8",

                success: function (result) {
                    console.log(result)
                    document.getElementById("billAmount").innerText = String(result["billAmount"]) + "/-";
                    document.getElementById("numberOfAttendences").innerText = String(result["numberOfAttendences"]) + "/-";
                    // you can see the result from the console
                    // tab of the developer tools
                },
                error: function (xhr, resp, text) {
                    // console.log("error")
                    console.log(xhr, resp, text);

                }
            });

        });
    </script>
    <script src="static/Student/script.js"></script>

</body>

</html>